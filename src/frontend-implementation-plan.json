{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Persist practice answers across navigation; add results review from backend; add subject-wise and overall rankings switcher",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Persist per-question selected answers across next/previous and jump navigation, and keep a complete in-session attempts set for final submission/review.",
      "acceptanceCriteria": [
        "After answering Question N and moving to Question N+1, returning to Question N shows the same selected option as previously chosen.",
        "The list of attempts shown at the end of the session includes answers for all questions that were answered during the session (not only the last question).",
        "Answer persistence works even if the student navigates using the Jump-to-Question navigator before finishing the session."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/PracticePage.tsx",
          "operation": "modify",
          "description": "Refactor practice session state to store answers/attempts keyed per question (e.g., by questionId or index) so selectedOption is restored when returning to a question, including via QuestionNavigator. Ensure that submitting an answer records/updates the attempt for that specific question (not only appending sequentially), and that final submission builds the attempts array from all saved attempts in question order so end-of-session includes all answered questions."
        },
        {
          "path": "frontend/src/components/practice/QuestionNavigator.tsx",
          "operation": "modify",
          "description": "Extend the navigator to optionally accept and render an “answered” indicator/state (e.g., styling) for questions that have a saved attempt, while keeping current selection highlighting and navigation behavior intact."
        },
        {
          "path": "frontend/src/types/practice.ts",
          "operation": "modify",
          "description": "Align/extend practice session types to support persisted per-question answers/attempts (e.g., map keyed by questionId/index) used by PracticePage for answer retention and complete attempt collection."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Replace placeholder results screen with an authoritative end-of-session review pulled from the backend test result, including score breakdown and per-question review.",
      "acceptanceCriteria": [
        "Backend exposes a query to retrieve a submitted test result by resultId with authorization that prevents other users from reading someone else’s result.",
        "Results page displays a real score breakdown derived from the stored attempts (correct/incorrect counts, accuracy, and per-question review showing chosen option vs correct option).",
        "Results page renders without placeholder text about missing backend support."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add a React Query hook to retrieve a submitted session review by testResultId using the existing backend capability (getSessionReviewByTestResultId). Include appropriate caching keys and error handling for authorization failures. Verify the authorization component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/ResultsPage.tsx",
          "operation": "modify",
          "description": "Implement results fetching by resultId via the new hook and render: overall score/accuracy, correct vs incorrect counts, average time (derived from attempts), and a per-question review list showing question text, chosen option, correct option, and correctness. Remove placeholder messaging. Add a minimal auth-aware guard: if the user is not authenticated, prompt them to log in before attempting to load personal results; handle unauthorized errors gracefully. Verify the authorization component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Add UI to switch between Overall leaderboard and subject-wise leaderboards (physics/chemistry/biology) and render a ranked table for the selected scope.",
      "acceptanceCriteria": [
        "Backend provides a query for a subject-specific leaderboard (for physics, chemistry, biology) that returns a sorted ranking comparable to the overall leaderboard.",
        "Rankings UI allows switching between Overall and a selected Subject leaderboard, and displays a ranked table of students for the chosen scope.",
        "Overall leaderboard remains available and unchanged in meaning (global)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add a React Query hook for subject leaderboard retrieval (getSubjectLeaderboard) parameterized by subject and with stable caching keys. Verify the authorization component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/RankingsPage.tsx",
          "operation": "modify",
          "description": "Add a scope switcher (Overall / Physics / Chemistry / Biology) and conditionally fetch/render either the existing overall leaderboard or the selected subject leaderboard. Keep overall leaderboard meaning unchanged. Update the table columns as needed for subject stats (e.g., questions answered, correct, accuracy), while preserving ranked ordering and current-user highlighting behavior where possible. Verify the authorization component's usage instructions before implementing."
        }
      ]
    }
  ]
}