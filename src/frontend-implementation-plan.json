{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Frontend: Immediate Admin Mode transition after successful unlock",
  "requirements": [
    {
      "id": "REQ-21",
      "summary": "Ensure Admin unlock updates UI state immediately (AdminPage gate -> panel and header Admin link appears) and show clear English invalid-password errors without needing a refresh.",
      "acceptanceCriteria": [
        "After entering \"9682\" and seeing a success confirmation, the Admin page renders the admin panel in the same session without a reload.",
        "After successful unlock, the header navigation shows the Admin button/link for the authenticated user.",
        "If the password is incorrect, the user sees an English error message indicating the password is invalid and remains on the gate screen."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useAuthz.ts",
          "operation": "modify",
          "description": "Update the Admin unlock mutation to immediately reflect Admin Mode in the UI by optimistically updating React Query cache for admin status (and, if applicable, caller role) on successful unlock, then invalidating/refetching to confirm. This ensures AdminPage and AppShell react instantly without manual refresh. Use the authorization componentâ€™s role/admin status pattern for UI access control; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/admin/AdminGateCard.tsx",
          "operation": "modify",
          "description": "Add visible, inline error feedback for invalid password attempts (in English) while keeping the user on the gate screen, and clear any prior error upon successful unlock. Ensure the success state triggers the immediate UI transition driven by cached admin status updates. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/layout/AppShell.tsx",
          "operation": "modify",
          "description": "Ensure the Admin navigation item reacts immediately to changes in cached admin status (no refresh), including after a successful unlock in the same session. Verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}